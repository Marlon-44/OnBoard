<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Pago con PayPal</title>
    <script src="https://www.paypal.com/sdk/js?client-id=AfgXcZFlv_chdwjATBp2sKyntpDZo0SMfKleySTozs4T9As8SSsmXXkA0LENNLWjrwgQ1JPjUR25mgi5&currency=USD"></script>
</head>
<body>
    <h2>Pagar con PayPal</h2>
    <div id="paypal-button-container"></div>

    <script>
        const idFactura = "123"; // Reemplaza con el ID real de la factura

        paypal.Buttons({
            createOrder: function(data, actions) {
                return fetch("http://localhost:8080/api/pagos/crear?idFactura=" + idFactura, {
                    method: "POST",
                })
                .then(response => response.text()) // El backend debe devolver solo el orderId
                .then(orderId => orderId);
            },

            onApprove: function(data, actions) {
                const orderId = data.orderID;

                return fetch("http://localhost:8080/api/pagos/capturar?orderId=" + orderId, {
                    method: "POST",
                })
                .then(response => response.text())
                .then(resultado => {
                    alert("Pago exitoso: " + resultado);
                })
                .catch(error => {
                    console.error("Error al capturar el pago:", error);
                    alert("Hubo un error al capturar el pago.");
                });
            }
        }).render('#paypal-button-container');
    </script>
</body>
</html>
